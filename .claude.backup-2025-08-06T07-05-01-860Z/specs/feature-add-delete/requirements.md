# Requirements: Prompt Vault Delete 功能

## 功能概述

为 Prompt Vault (pv) CLI 应用添加删除功能，允许用户通过三种不同的交互模式删除已存储的提示(prompts)。该功能将集成 bubbletea 提供交互式用户界面，并与现有的 GitHub Gists 存储系统无缝集成。

## 业务价值

- **提升用户体验**: 提供直观的删除操作，支持多种使用场景
- **数据管理**: 允许用户清理不需要的提示，保持收藏夹整洁
- **操作安全性**: 通过确认机制防止误删重要数据
- **工作流集成**: 与现有的 `pv list` 和 `pv add` 命令形成完整的 CRUD 操作链

## 用户故事

### 故事 1: 交互式列表删除
**作为** Prompt Vault 用户  
**我希望** 运行 `pv delete` 时能看到所有提示的列表，并通过数字键选择要删除的提示  
**以便** 我可以直观地浏览并选择需要删除的内容  

**验收标准 (EARS)**:
- WHEN 用户运行 `pv delete` 命令且没有参数
- THEN 系统应该显示所有可用提示的编号列表
- AND 每个提示显示格式为: `[数字] 提示名称 (作者: 作者名)`
- AND 用户可以通过输入数字选择要删除的提示
- AND 系统在删除前显示确认提示
- AND 用户确认后执行删除操作并从 GitHub Gist 和索引中移除
- AND 删除成功后显示成功消息

### 故事 2: 关键字筛选删除  
**作为** Prompt Vault 用户  
**我希望** 运行 `pv delete <keyword>` 时能看到匹配关键字的提示列表，并选择要删除的内容  
**以便** 我可以快速找到并删除特定的提示  

**验收标准 (EARS)**:
- WHEN 用户运行 `pv delete <keyword>` 命令
- THEN 系统应该根据关键字筛选提示(匹配名称、作者或描述)
- AND 显示匹配结果的编号列表
- IF 没有匹配结果 THEN 显示 "未找到匹配的提示" 消息
- IF 有匹配结果 THEN 允许用户通过数字选择要删除的提示
- AND 系统在删除前显示确认提示，包含提示的详细信息
- AND 用户确认后执行删除操作

### 故事 3: 直接 URL 删除
**作为** Prompt Vault 用户  
**我希望** 运行 `pv delete <gist_url>` 时能直接删除指定 URL 的提示  
**以便** 我可以精确删除已知的特定提示  

**验收标准 (EARS)**:
- WHEN 用户运行 `pv delete <gist_url>` 命令且提供有效的 GitHub Gist URL
- THEN 系统应该在索引中查找对应的提示
- IF 找到匹配的提示 THEN 显示提示详细信息和确认提示
- IF 未找到匹配的提示 THEN 显示 "未找到指定的提示" 错误消息
- AND 用户确认后从 GitHub Gist 和索引中删除提示
- AND 删除成功后显示成功消息

### 故事 4: 删除别名支持
**作为** Prompt Vault 用户  
**我希望** 可以使用 `pv del` 作为 `pv delete` 的简短别名  
**以便** 我可以更快速地执行删除操作  

**验收标准 (EARS)**:
- WHEN 用户运行 `pv del` 命令(不带参数、带关键字或带URL)
- THEN 系统应该表现得与 `pv delete` 完全相同
- AND 所有删除功能都应该通过 `del` 别名正常工作

## 非功能性需求

### 用户体验要求
- **交互性**: 使用 bubbletea 框架提供流畅的终端用户界面
- **响应性**: 列表加载和筛选操作应在 2 秒内完成
- **一致性**: 界面风格与现有 `pv list` 命令保持一致
- **可访问性**: 支持键盘导航，提供清晰的操作提示

### 安全性要求
- **确认机制**: 所有删除操作都必须经过用户明确确认
- **错误恢复**: 删除失败时应保持数据完整性
- **权限验证**: 删除 GitHub Gist 前验证用户权限

### 技术要求
- **依赖管理**: 添加 bubbletea 库到项目依赖中
- **架构集成**: 与现有的 Cobra CLI 和 Wire 依赖注入系统集成
- **存储兼容**: 使用现有的 Store 接口，无需修改存储层逻辑
- **测试支持**: 实现 TTY 测试解决方案以支持 bubbletea 组件测试

## 错误处理需求

### 错误场景
1. **网络错误**: GitHub API 不可用或访问受限
2. **权限错误**: 用户无权删除指定的 GitHub Gist  
3. **数据不一致**: 索引中存在但 Gist 不存在的提示
4. **输入错误**: 无效的 URL 格式或不存在的数字选择
5. **认证错误**: 用户未登录或 token 无效

### 错误处理策略
- **友好消息**: 所有错误都应显示用户友好的中文错误消息
- **操作指导**: 错误消息应包含解决问题的建议步骤
- **状态保护**: 错误发生时不应损坏用户的数据或配置
- **优雅退出**: 错误情况下程序应正常退出而不崩溃

## 约束条件

### 技术约束
- 必须使用 Go 1.24.5 及现有的技术栈
- 必须兼容现有的 GitHub Gists 存储系统
- 必须保持现有 CLI 命令的兼容性
- 必须支持跨平台运行(Linux, macOS, Windows)

### 业务约束  
- 删除操作不可撤销，必须通过确认机制保护用户数据
- 必须与现有的身份验证系统集成
- 必须保持与现有用户工作流的兼容性

## 成功标准

### 功能完整性
- [ ] 所有三种删除模式都能正常工作
- [ ] 交互式界面响应流畅且直观
- [ ] 所有错误场景都有适当的处理
- [ ] 删除操作与存储系统正确同步

### 质量标准
- [ ] 单元测试覆盖率达到 80% 以上
- [ ] 集成测试涵盖所有主要用户场景  
- [ ] 性能测试验证响应时间要求
- [ ] 用户验收测试通过所有用户故事

### 集成标准
- [ ] 与现有命令系统无缝集成
- [ ] 依赖注入配置正确更新
- [ ] 构建和部署流程无修改需要
- [ ] 向后兼容性完全保持

## 风险评估

### 高风险
- **bubbletea 集成复杂性**: 新的 TUI 框架可能与现有架构产生冲突
- **TTY 测试挑战**: bubbletea 需要 TTY 环境，可能影响 CI/CD 测试

### 中风险  
- **GitHub API 限制**: 删除操作受 GitHub API 速率限制影响
- **并发操作**: 多个删除操作可能导致索引不一致

### 低风险
- **用户接受度**: 新的交互模式可能需要用户适应时间
- **维护成本**: 额外的依赖增加长期维护负担

## 依赖关系

### 外部依赖
- `github.com/charmbracelet/bubbletea`: 交互式 TUI 框架
- GitHub Gists API: 远程存储删除操作
- 现有的 OAuth2 认证系统

### 内部依赖  
- `internal/infra/store.go`: Store 接口的 Delete 方法
- `internal/di/`: 依赖注入系统更新
- `cmd/`: 新的 delete 命令集成

## 验收测试场景

### 场景 1: 基本删除流程
```bash
# 用户运行删除命令
pv delete

# 系统显示提示列表
# 用户选择数字 2
# 系统显示确认提示
# 用户确认
# 系统执行删除并显示成功消息
```

### 场景 2: 关键字筛选删除
```bash  
# 用户使用关键字筛选
pv delete "golang"

# 系统显示匹配"golang"的提示
# 用户选择要删除的提示
# 确认并删除
```

### 场景 3: URL 直接删除
```bash
# 用户提供 Gist URL
pv delete https://gist.github.com/user/abc123

# 系统找到对应提示并显示详情
# 用户确认删除
# 执行删除操作
```

### 场景 4: 错误处理
```bash
# 用户提供无效 URL
pv delete invalid-url

# 系统显示友好错误消息
# 提供正确使用方法
```

这些需求定义了 `pv delete` 功能的完整规范，确保了功能完整性、用户体验和技术可行性。所有需求都与现有系统架构兼容，并提供了清晰的实现指导。
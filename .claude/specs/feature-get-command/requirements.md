# 需求文档

## 功能名称
feature-get-command

## 功能描述
为 pv CLI 添加 `get` 命令，允许用户选择、自定义并将提示词复制到剪贴板，支持变量替换功能。

## 用户故事

### US1: 交互式提示词选择
**作为** 提示词用户  
**我希望** 运行不带参数的 `pv get`  
**以便** 我可以交互式地浏览和选择所有可用的提示词

**验收标准:**
- 当我运行不带参数的 `pv get` 时，系统应显示与 `pv delete` 相同的 TUI 列表
- 当我使用方向键导航列表时，我可以看到所有可用的提示词
- 当我在选中的提示词上按回车键时，系统应进入变量处理流程
- 当我按 'q' 或 Ctrl+C 时，系统应优雅退出且不复制任何内容

### US2: 关键字筛选选择
**作为** 提示词用户  
**我希望** 运行带搜索词的 `pv get <keyword>`  
**以便** 我可以快速从筛选列表中找到并选择相关提示词

**验收标准:**
- 当我运行 `pv get "test"` 时，系统应仅显示名称、作者或描述中包含 "test" 的提示词
- 当筛选列表有结果时，我可以使用相同的 TUI 从筛选后的提示词中选择
- 当筛选列表为空时，系统应显示友好的 "未找到匹配项" 消息
- 当关键字包含中文字符时，系统应支持 Unicode 匹配

### US3: 直接 URL 访问
**作为** 提示词用户  
**我希望** 运行带特定 URL 的 `pv get <gist_url>`  
**以便** 我可以直接访问已知的提示词而无需浏览

**验收标准:**
- 当我提供有效的 GitHub Gist URL 时，系统应获取该特定提示词
- 当我提供无效 URL 时，系统应显示清晰的错误消息
- 当 URL 不存在或无法访问时，系统应优雅地处理错误
- 当 URL 有效时，系统应直接进入变量处理流程

### US4: 变量替换表单
**作为** 提示词用户  
**我希望** 在选择或直接访问提示词后，如果提示词包含 `{variable}` 占位符则显示表单  
**以便** 我可以在复制前自定义提示词内容

**验收标准:**
- 当用户通过任何方式（交互选择、关键字筛选、直接URL）获取到提示词后，系统应检查提示词内容
- 当提示词内容包含 `{variable}` 语法时，系统应显示 bubbletea 变量输入表单
- 当表单显示时，我可以看到所有从提示词中提取的变量字段
- 当我填写变量值时，表单应验证输入不为空
- 当我提交完整的表单时，系统应用我的值替换提示词中所有对应的占位符
- 当提示词不包含任何 `{variable}` 占位符时，系统应跳过变量表单，直接将原始提示词内容复制到剪贴板

### US5: 剪贴板集成
**作为** 提示词用户  
**我希望** 处理后的提示词复制到我的剪贴板  
**以便** 我可以立即粘贴到目标应用程序中

**验收标准:**
- 当变量替换完成时，最终的提示词内容应复制到剪贴板
- 当复制成功时，系统应显示成功消息
- 当剪贴板访问失败时，系统应显示内容和错误消息
- 当操作完成时，系统应干净地退出

## 功能需求

### FR1: 命令结构
- 支持三种调用模式：`pv get`、`pv get <keyword>`、`pv get <url>`
- 与现有 Cobra CLI 框架集成
- 遵循与其他命令相同的认证要求

### FR2: TUI 集成
- 复用删除命令中现有的 PromptListModel
- 实现新的 VariableFormModel 用于输入收集
- 保持一致的样式和导航模式

### FR3: 变量处理流程
- 在获取到提示词内容后，首先检查是否包含 `{variable_name}` 语法
- 如果包含变量，则解析提示词内容提取所有唯一的变量名
- 显示变量输入表单收集用户输入的变量值
- 用用户输入的值替换提示词中所有对应变量的实例
- 如果不包含变量，则跳过表单直接进入剪贴板复制流程

### FR4: 错误处理
- 优雅处理网络故障
- 处理前验证 GitHub Gist URL
- 为所有故障模式提供清晰的错误消息
- 支持在任何阶段优雅取消

## 非功能需求

### NFR1: 性能
- 在正常网络条件下，列表加载应在 2 秒内完成
- 变量表单应在 100ms 内响应输入
- 剪贴板操作应在 500ms 内完成

### NFR2: 可用性
- TUI 应遵循删除命令的现有导航模式
- 错误消息应用户友好且可操作
- 表单输入应支持标准终端编辑（退格、方向键）

### NFR3: 可靠性
- 命令应能使用缓存的提示词列表离线工作
- 应优雅处理网络中断
- 应在处理前验证所有用户输入

## 技术需求

### TR1: 架构集成
- 扩展现有的 PromptService 接口
- 复用 GitHubStore 进行提示词获取
- 与现有 TUI 框架集成
- 遵循依赖注入模式

### TR2: 需要的新组件
- 遵循 Cobra 模式的 GetCommand 结构体
- 用于 bubbletea TUI 的 VariableFormModel
- 变量解析和替换逻辑
- 剪贴板集成工具

### TR3: 测试需求
- 变量解析和替换的单元测试
- 使用现有模式的 TUI 交互测试
- 所有三种命令模式的集成测试
- 剪贴板操作的模拟测试

## 依赖项和假设

### 依赖项
- 现有的 PromptService 和 GitHubStore 实现
- 当前的 bubbletea TUI 框架设置
- 系统剪贴板访问能力
- GitHub Gists API 可用性

### 假设
- 用户具有剪贴板访问权限
- 具备网络连接以获取最新提示词
- 现有认证机制正常工作
- 变量语法仅遵循 `{variable_name}` 模式

## 成功标准
- 所有三种命令模式按规范工作
- 变量替换正确处理复杂情况
- TUI 提供与现有模式匹配的流畅用户体验
- 剪贴板集成在不同操作系统上工作
- 错误处理涵盖所有识别的边缘情况
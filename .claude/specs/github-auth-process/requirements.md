# 需求文档 - github-auth-process

## 概述
使用个人访问令牌（Personal Access Token, PAT）实现 GitHub 认证功能，以访问 GitHub Gist API 来存储和检索提示词。此功能将允许 Prompt Vault CLI 使用 GitHub Gists 作为后端存储机制。

## 用户故事

### US1: 初始 GitHub 认证
**作为** CLI 用户
**我想要** 使用我的个人访问令牌来认证 GitHub
**以便** 我可以从我的 GitHub Gists 存储和检索提示词

### US2: 安全的令牌存储
**作为** CLI 用户
**我想要** 在本地安全地存储我的 GitHub PAT
**以便** 我不需要每次命令都重新输入

### US3: 令牌验证
**作为** CLI 用户
**我想要** 验证我的 GitHub PAT 是否有效并具有所需权限
**以便** 我可以确保正确访问 GitHub Gist API

### US4: 认证状态检查
**作为** CLI 用户
**我想要** 检查我当前的认证状态
**以便** 我知道是否已登录以及哪个账户处于活动状态

## 验收标准

### AC1: 认证命令
- **当** 用户运行 `pv auth login`
- **那么** 系统应该提示输入 GitHub 个人访问令牌
- **并且** 使用 GitHub API 验证令牌
- **并且** 在验证成功后安全存储令牌

### AC2: 令牌验证
- **当** 用户在登录时提供 PAT
- **那么** 系统应该验证令牌具有 `gist` 权限
- **并且** 成功时显示已认证的用户名
- **并且** 如果令牌无效或缺少权限时显示清晰的错误消息

### AC3: 安全存储
- **当** 存储有效令牌时
- **那么** 应该保存在用户主目录中
- **并且** 文件应该有受限权限（Unix 系统上为 600）
- **并且** 令牌应该被加密或混淆

### AC4: 认证状态
- **当** 用户运行 `pv auth status`
- **那么** 系统应该显示当前认证状态
- **并且** 如果已认证则显示 GitHub 用户名
- **并且** 如果未认证则指示无认证

### AC5: 登出功能
- **当** 用户运行 `pv auth logout`
- **那么** 系统应该删除存储的令牌
- **并且** 确认成功登出

### AC6: 错误处理
- **当** GitHub API 无法访问
- **那么** 系统应该显示清晰的连接错误
- **并且** 建议检查互联网连接或 GitHub 状态

## 技术约束

### TC1: Go 标准库
- 尽可能使用 Go 标准库进行 HTTP 请求
- 为了安全性和可维护性，最小化外部依赖

### TC2: 跨平台兼容性
- 令牌存储机制必须在 Windows、macOS 和 Linux 上工作
- 文件权限处理应该感知操作系统

### TC3: 现有架构
- 必须与当前的 Wire 依赖注入设置集成
- 遵循使用 Cobra 的现有命令结构
- 通过 Store 接口模式实现存储

## 安全考虑

### SC1: 令牌保护
- 永远不要在任何输出中记录或显示完整的 PAT
- 在任何调试或错误消息中屏蔽令牌

### SC2: 安全存储
- 在用户主目录中存储令牌，并设置受限权限
- 在未来迭代中考虑使用操作系统密钥链/凭证管理器

### SC3: 仅使用 HTTPS
- 所有 GitHub API 通信必须使用 HTTPS
- 验证 SSL 证书

## 性能要求

### PR1: 响应时间
- 在正常网络条件下，令牌验证应在 3 秒内完成
- 本地令牌验证应该几乎即时

### PR2: API 速率限制
- 遵守 GitHub API 速率限制
- 缓存认证状态以最小化 API 调用

## 依赖项

### D1: GitHub API
- GitHub REST API v3 用于认证和 gist 操作
- 验证时需要活跃的互联网连接

### D2: 本地存储
- 令牌存储的文件系统访问
- 特定于操作系统的权限 API

## 超出范围

### OS1: OAuth 流程
- 不包括基于浏览器的 OAuth 认证流程
- 仅支持个人访问令牌认证

### OS2: 多账户
- 同时支持多个 GitHub 账户
- 账户切换功能

### OS3: 令牌轮换
- 自动令牌刷新或轮换
- 令牌过期处理